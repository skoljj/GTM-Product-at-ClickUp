<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Module 1 — Contributor Layer</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{background:#020408;overflow:hidden;font-family:'SF Pro Display',system-ui,-apple-system,sans-serif;color:#c8d6e5}
canvas{position:fixed;top:0;left:0;z-index:0}
#hud{position:fixed;top:16px;left:16px;z-index:100;pointer-events:none}
#hud h1{font-size:11px;color:#00e5ff;font-weight:300;letter-spacing:.15em;text-transform:uppercase;opacity:.9}
#hud .sub{font-size:9px;color:#445566;margin-top:3px;letter-spacing:.08em}
#hud .title{font-size:28px;font-weight:200;letter-spacing:.04em;margin-top:8px;color:#00e5ff}
#hint{position:fixed;bottom:24px;left:50%;transform:translateX(-50%);z-index:100;font-size:9px;letter-spacing:.15em;text-transform:uppercase;color:rgba(100,130,160,.5);pointer-events:none;transition:opacity .8s}
#back{position:fixed;bottom:24px;right:24px;z-index:100;background:rgba(8,12,24,.85);border:1px solid rgba(0,229,255,.2);color:#00e5ff;padding:6px 14px;border-radius:3px;cursor:pointer;font-size:9px;letter-spacing:.1em;text-transform:uppercase;text-decoration:none;backdrop-filter:blur(8px)}
#back:hover{border-color:rgba(0,229,255,.5)}
</style>
</head>
<body>
<div id="hud">
  <h1>Capability Architecture · Module 1</h1>
  <div class="sub">Drag to orbit · Scroll to zoom</div>
  <div class="title">CONTRIBUTOR LAYER</div>
</div>
<div id="hint">DRAG TO ORBIT 360° · SCROLL TO ZOOM</div>
<a id="back" href="../product_design_concept1.html">← Full Diagram</a>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script>
// ═══ SCENE BOILERPLATE ═══
const scene=new THREE.Scene();
scene.fog=new THREE.FogExp2(0x020408,0.0006);
const camera=new THREE.PerspectiveCamera(50,innerWidth/innerHeight,0.1,2500);
const renderer=new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth,innerHeight);
renderer.setPixelRatio(Math.min(devicePixelRatio,2));
renderer.toneMapping=THREE.ACESFilmicToneMapping;
renderer.toneMappingExposure=1.15;
document.body.appendChild(renderer.domElement);

// Orbit
let drag=false,pM={x:0,y:0};
let sph={theta:0.6,phi:0.85,r:55};
const lookTarget=new THREE.Vector3(0,60,0);
function camUp(){
  camera.position.x=lookTarget.x+sph.r*Math.sin(sph.phi)*Math.sin(sph.theta);
  camera.position.y=lookTarget.y+sph.r*Math.cos(sph.phi);
  camera.position.z=lookTarget.z+sph.r*Math.sin(sph.phi)*Math.cos(sph.theta);
  camera.lookAt(lookTarget);
}
camUp();
renderer.domElement.addEventListener('pointerdown',e=>{drag=true;pM={x:e.clientX,y:e.clientY}});
renderer.domElement.addEventListener('pointermove',e=>{if(!drag)return;sph.theta-=(e.clientX-pM.x)*0.005;sph.phi=Math.max(0.1,Math.min(2.9,sph.phi+(e.clientY-pM.y)*0.005));pM={x:e.clientX,y:e.clientY};camUp()});
renderer.domElement.addEventListener('pointerup',()=>drag=false);
renderer.domElement.addEventListener('pointerleave',()=>drag=false);
renderer.domElement.addEventListener('wheel',e=>{e.preventDefault();sph.r=Math.max(20,Math.min(150,sph.r+e.deltaY*0.1));camUp()},{passive:false});

// Lights
scene.add(new THREE.AmbientLight(0x223344,0.5));
[[0x00e5ff,2.2,[-15,80,-10]],[0xc77dff,2.0,[20,10,15]],[0xff6b9d,0.8,[25,50,20]],
[0xf4a623,1.5,[0,-75,0]],[0x00e5ff,1.8,[0,60,0]]]
.forEach(([c,i,p])=>{const pl=new THREE.PointLight(c,i,250);pl.position.set(...p);scene.add(pl)});

// Stars
const starGeo=new THREE.BufferGeometry();const sP=new Float32Array(5000*3);
for(let i=0;i<5000;i++){const r=300+Math.random()*600,th=Math.random()*Math.PI*2,ph=Math.acos(2*Math.random()-1);
sP[i*3]=r*Math.sin(ph)*Math.cos(th);sP[i*3+1]=r*Math.sin(ph)*Math.sin(th);sP[i*3+2]=r*Math.cos(ph)}
starGeo.setAttribute('position',new THREE.BufferAttribute(sP,3));
scene.add(new THREE.Points(starGeo,new THREE.PointsMaterial({color:0x5577aa,size:0.3,transparent:true,opacity:0.4})));

// ═══ CONSTANTS ═══
const QCOL=[new THREE.Color(0x00e5a0),new THREE.Color(0x6366f1),new THREE.Color(0xf4a623),new THREE.Color(0xe63946)];
const DISTRICTS=[
  {name:'COMMERCIAL',bldgs:17,ics:102,color:0x00e5ff},
  {name:'ENTERPRISE',bldgs:9,ics:54,color:0x818cf8},
  {name:'PARTNERSHIPS',bldgs:3,ics:18,color:0xc77dff},
  {name:'POST SALES',bldgs:3,ics:18,color:0xff6b9d},
  {name:'XDR',bldgs:3,ics:18,color:0x34d399},
  {name:'OPERATIONS',bldgs:3,ics:18,color:0xf4a623},
];
const CONT_Y=60;

// ═══ CONTRIBUTOR LAYER (Y=60) ═══
const coW=80,coD=68;
// Outer border
scene.add((()=>{const m=new THREE.Mesh(new THREE.BoxGeometry(coW,0.35,coD),new THREE.MeshPhysicalMaterial({color:0x1a1410,metalness:0.88,roughness:0.12,clearcoat:0.4}));m.position.y=CONT_Y-0.18;return m})());
scene.add((()=>{const m=new THREE.LineSegments(new THREE.EdgesGeometry(new THREE.BoxGeometry(coW,0.35,coD)),new THREE.LineBasicMaterial({color:0xf4a623,transparent:true,opacity:0.3}));m.position.y=CONT_Y-0.18;return m})());
// Inner platform
const ciW=74,ciD=62;
scene.add((()=>{const m=new THREE.Mesh(new THREE.BoxGeometry(ciW,0.5,ciD),new THREE.MeshPhysicalMaterial({color:0x080c18,metalness:0.95,roughness:0.06,clearcoat:1,clearcoatRoughness:0.03}));m.position.y=CONT_Y;return m})());
scene.add((()=>{const m=new THREE.LineSegments(new THREE.EdgesGeometry(new THREE.BoxGeometry(ciW,0.5,ciD)),new THREE.LineBasicMaterial({color:0x00e5ff,transparent:true,opacity:0.35}));m.position.y=CONT_Y;return m})());
scene.add((()=>{const g=new THREE.GridHelper(72,80,0x0a1525,0x070d18);g.position.y=CONT_Y+0.26;return g})());

// Main label
(()=>{const c=document.createElement('canvas');c.width=512;c.height=64;const x=c.getContext('2d');
x.font='bold 28px monospace';x.fillStyle='#00e5ff';x.globalAlpha=0.5;x.textAlign='center';x.fillText('CONTRIBUTOR LAYER',256,32);
x.font='400 16px monospace';x.globalAlpha=0.3;x.fillText('38 Buildings | 228 ICs | 6 Floors',256,54);
const s=new THREE.Sprite(new THREE.SpriteMaterial({map:new THREE.CanvasTexture(c),transparent:true}));
s.position.set(0,CONT_Y+8,0);s.scale.set(30,3.8,1);scene.add(s)})();

// District zones
const CONT_ZONES=[
  {di:0,cx:-20,cz:-16,w:28,d:22},{di:1,cx:16,cz:-16,w:18,d:22},{di:2,cx:30,cz:-16,w:8,d:22},
  {di:3,cx:-28,cz:18,w:14,d:14},{di:4,cx:-12,cz:18,w:12,d:14},{di:5,cx:8,cz:18,w:16,d:14},
];
const allAntennas=[];

function makeBuilding(x,z,scale,distColor){
  const g=new THREE.Group();g.position.set(x,CONT_Y+0.27,z);
  const bw=1.8*scale,bd=1.8*scale,fH=0.55*scale,nF=6;const dc=new THREE.Color(distColor||0x00e5ff);
  g.add((()=>{const m=new THREE.Mesh(new THREE.BoxGeometry(bw+0.3,0.04,bd+0.3),new THREE.MeshBasicMaterial({color:dc,transparent:true,opacity:0.08}));m.position.y=0.02;return m})());
  g.add((()=>{const m=new THREE.LineSegments(new THREE.EdgesGeometry(new THREE.BoxGeometry(bw+0.3,0.04,bd+0.3)),new THREE.LineBasicMaterial({color:dc,transparent:true,opacity:0.35}));m.position.y=0.02;return m})());
  const hw=bw/2,hd=bd/2;
  const quads=[{ox:-hw/2,oz:-hd/2},{ox:hw/2,oz:-hd/2},{ox:-hw/2,oz:hd/2},{ox:hw/2,oz:hd/2}];
  const qW=hw-0.03,qD=hd-0.03;
  for(let f=0;f<nF;f++){const fy=0.04+f*fH;
    for(let q=0;q<4;q++){const sc=QCOL[q];const{ox,oz}=quads[q];const qGeo=new THREE.BoxGeometry(qW,fH*0.78,qD);
      g.add((()=>{const m=new THREE.Mesh(qGeo,new THREE.MeshPhysicalMaterial({color:sc,transparent:true,opacity:0.07+f*0.013,metalness:0.2,roughness:0.3,side:THREE.DoubleSide}));m.position.set(ox,fy+fH*0.39,oz);return m})());
      g.add((()=>{const m=new THREE.LineSegments(new THREE.EdgesGeometry(qGeo),new THREE.LineBasicMaterial({color:sc,transparent:true,opacity:0.28+f*0.04}));m.position.set(ox,fy+fH*0.39,oz);return m})());}
    const cMat=new THREE.LineBasicMaterial({color:0x223344,transparent:true,opacity:0.12});
    g.add(new THREE.Line(new THREE.BufferGeometry().setFromPoints([new THREE.Vector3(-hw,fy+fH*0.39,0),new THREE.Vector3(hw,fy+fH*0.39,0)]),cMat));
    g.add(new THREE.Line(new THREE.BufferGeometry().setFromPoints([new THREE.Vector3(0,fy+fH*0.39,-hd),new THREE.Vector3(0,fy+fH*0.39,hd)]),cMat));}
  const totalH=nF*fH,antH=0.85*scale;
  g.add((()=>{const m=new THREE.Mesh(new THREE.CylinderGeometry(0.015,0.015,antH,4),new THREE.MeshBasicMaterial({color:0x334455}));m.position.y=totalH+0.04+antH/2;return m})());
  const tip=new THREE.Mesh(new THREE.SphereGeometry(0.055,6,6),new THREE.MeshBasicMaterial({color:0x00e5ff,transparent:true}));
  tip.position.y=totalH+0.04+antH;tip.userData={ph:Math.random()*Math.PI*2};g.add(tip);allAntennas.push(tip);
  scene.add(g);return g;
}

CONT_ZONES.forEach(z=>{const d=DISTRICTS[z.di];
  scene.add((()=>{const m=new THREE.LineSegments(new THREE.EdgesGeometry(new THREE.BoxGeometry(z.w,0.04,z.d)),new THREE.LineBasicMaterial({color:d.color,transparent:true,opacity:0.2}));m.position.set(z.cx,CONT_Y+0.28,z.cz);return m})());
  const fill=new THREE.Mesh(new THREE.PlaneGeometry(z.w-0.3,z.d-0.3),new THREE.MeshBasicMaterial({color:d.color,transparent:true,opacity:0.015,side:THREE.DoubleSide}));
  fill.rotation.x=-Math.PI/2;fill.position.set(z.cx,CONT_Y+0.27,z.cz);scene.add(fill);
  const cvs=document.createElement('canvas');cvs.width=512;cvs.height=80;const ctx=cvs.getContext('2d');
  ctx.font='bold 22px monospace';ctx.fillStyle='#'+d.color.toString(16).padStart(6,'0');ctx.globalAlpha=0.6;ctx.textAlign='left';ctx.fillText(d.name,16,34);
  ctx.font='400 17px monospace';ctx.globalAlpha=0.3;ctx.fillText(d.bldgs+' bldgs | '+d.ics+' ICs',16,58);
  const sp=new THREE.Sprite(new THREE.SpriteMaterial({map:new THREE.CanvasTexture(cvs),transparent:true,opacity:0.85}));
  sp.position.set(z.cx-z.w/2+3,CONT_Y+0.6,z.cz-z.d/2+1);sp.scale.set(z.w*0.5,z.w*0.09,1);scene.add(sp);
});

// Place buildings
const SP=3.4;const cZn=CONT_ZONES[0];const r9X=cZn.cx-8,r9Z=cZn.cz-4;
for(let r=0;r<3;r++)for(let c=0;c<3;c++)makeBuilding(r9X+c*SP,r9Z+r*SP,0.88,0x00e5ff);
const r5X=cZn.cx+4,r5Z=cZn.cz-4;for(let i=0;i<5;i++)makeBuilding(r5X,r5Z+i*SP,0.88,0x00e5ff);
const r3X=cZn.cx+8,r3Z=cZn.cz-1;for(let i=0;i<3;i++)makeBuilding(r3X,r3Z+i*SP,0.88,0x00e5ff);
const eZn=CONT_ZONES[1];for(let r=0;r<3;r++)for(let c=0;c<3;c++)makeBuilding(eZn.cx-3.5+c*3.8,eZn.cz-3+r*3.8,0.95,0x818cf8);
const pZn=CONT_ZONES[2];for(let i=0;i<3;i++)makeBuilding(pZn.cx,pZn.cz-5+i*5.5,1.05,0xc77dff);
const psZn=CONT_ZONES[3];makeBuilding(psZn.cx-2.5,psZn.cz-1.5,1.05,0xff6b9d);makeBuilding(psZn.cx+2.5,psZn.cz-1.5,1.05,0xff6b9d);makeBuilding(psZn.cx,psZn.cz+3,1.05,0xff6b9d);
const xZn=CONT_ZONES[4];for(let i=0;i<3;i++)makeBuilding(xZn.cx-2+i*3.5,xZn.cz,1.0,0x34d399);
const oZn=CONT_ZONES[5];makeBuilding(oZn.cx-2.5,oZn.cz-1,1.1,0xf4a623);makeBuilding(oZn.cx+2.5,oZn.cz-1,1.1,0xf4a623);makeBuilding(oZn.cx,oZn.cz+3,1.1,0xf4a623);

// Fountain
const fCX=0,fCZ=2;
scene.add((()=>{const m=new THREE.Mesh(new THREE.CylinderGeometry(8,8,0.4,48),new THREE.MeshPhysicalMaterial({color:0x0a1528,metalness:0.9,roughness:0.1,transparent:true,opacity:0.7}));m.position.set(fCX,CONT_Y+0.47,fCZ);return m})());
scene.add((()=>{const m=new THREE.LineSegments(new THREE.EdgesGeometry(new THREE.CylinderGeometry(8,8,0.4,48)),new THREE.LineBasicMaterial({color:0x00e5ff,transparent:true,opacity:0.5}));m.position.set(fCX,CONT_Y+0.47,fCZ);return m})());
for(let r=2;r<=7;r+=1.5){const ring=new THREE.Mesh(new THREE.RingGeometry(r-0.03,r+0.03,48),new THREE.MeshBasicMaterial({color:0x00e5ff,transparent:true,opacity:0.06,side:THREE.DoubleSide}));ring.rotation.x=-Math.PI/2;ring.position.set(fCX,CONT_Y+0.69,fCZ);scene.add(ring)}

// Fountain particles
const fpN=1200;const fpGeo=new THREE.BufferGeometry();const fpPos=new Float32Array(fpN*3),fpVel=new Float32Array(fpN),fpCol=new Float32Array(fpN*3);
const fpColors=[new THREE.Color(0x00e5ff),new THREE.Color(0xc77dff),new THREE.Color(0x00e5a0),new THREE.Color(0x6366f1),new THREE.Color(0xf4a623),new THREE.Color(0xe63946)];
for(let i=0;i<fpN;i++){const a=Math.random()*Math.PI*2,r=Math.random()*1.2;fpPos[i*3]=fCX+Math.cos(a)*r;fpPos[i*3+1]=CONT_Y+0.7+Math.random()*14;fpPos[i*3+2]=fCZ+Math.sin(a)*r;fpVel[i]=0.02+Math.random()*0.06;const c=fpColors[Math.floor(Math.random()*fpColors.length)];fpCol[i*3]=c.r;fpCol[i*3+1]=c.g;fpCol[i*3+2]=c.b}
fpGeo.setAttribute('position',new THREE.BufferAttribute(fpPos,3));fpGeo.setAttribute('color',new THREE.BufferAttribute(fpCol,3));
const fountainPts=new THREE.Points(fpGeo,new THREE.PointsMaterial({size:0.15,vertexColors:true,transparent:true,opacity:0.8,blending:THREE.AdditiveBlending}));scene.add(fountainPts);
const apexOrb=new THREE.Mesh(new THREE.SphereGeometry(0.8,16,16),new THREE.MeshBasicMaterial({color:0x00e5ff,transparent:true,opacity:0.25}));apexOrb.position.set(fCX,CONT_Y+10,fCZ);scene.add(apexOrb);

// ═══ ANIMATE ═══
const clock=new THREE.Clock();
function animate(){
  requestAnimationFrame(animate);const t=clock.getElapsedTime();
  allAntennas.forEach(tip=>{tip.material.opacity=0.15+0.85*Math.abs(Math.sin(t*2.5+tip.userData.ph))});
  const fp=fountainPts.geometry.attributes.position.array;
  for(let i=0;i<fpN;i++){fp[i*3+1]+=fpVel[i];const angle=t*0.8+i*0.02,radius=0.3+(fp[i*3+1]-CONT_Y-0.7)*0.08;
  fp[i*3]=fCX+Math.cos(angle+i)*radius;fp[i*3+2]=fCZ+Math.sin(angle+i)*radius;
  if(fp[i*3+1]>CONT_Y+14){fp[i*3+1]=CONT_Y+0.7;const a=Math.random()*Math.PI*2;fp[i*3]=fCX+Math.cos(a)*Math.random()*0.8;fp[i*3+2]=fCZ+Math.sin(a)*Math.random()*0.8}}
  fountainPts.geometry.attributes.position.needsUpdate=true;
  const as=0.8+0.3*Math.sin(t*1.5);apexOrb.scale.set(as,as,as);apexOrb.material.opacity=0.15+0.15*Math.sin(t*2);apexOrb.position.y=CONT_Y+10+Math.sin(t*0.6)*0.5;
  renderer.render(scene,camera);
}
animate();
window.addEventListener('resize',()=>{camera.aspect=innerWidth/innerHeight;camera.updateProjectionMatrix();renderer.setSize(innerWidth,innerHeight)});
setTimeout(()=>{document.getElementById('hint').style.opacity='0'},5000);
</script>
</body>
</html>
